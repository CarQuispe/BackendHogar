generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Tabla de Usuarios
model User {
  id           String    @id @default(uuid())
  email        String    @unique
  passwordHash String    @map("password_hash")
  name         String
  lastName     String    @map("last_name")
  rut          String?   @unique
  phone        String?
  role         Role      @default(VOLUNTARIO)
  isActive     Boolean   @default(true) @map("is_active")
  sedeId       String?   @map("sede_id")
  
  // Relaciones
  sede         Sede?     @relation(fields: [sedeId], references: [id])
  
  // Timestamps
  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt @map("updated_at")
  lastLogin    DateTime? @map("last_login")
  
  @@map("users")
}

// Tabla de Sedes
model Sede {
  id              String   @id @default(uuid())
  name            String   @unique
  type            SedeType @default(CASA_ACOGIDA)
  address         String
  comuna          String?
  region          String?
  phone           String?
  maxCapacity     Int      @default(20) @map("max_capacity")
  currentCapacity Int      @default(0) @map("current_capacity")
  isActive        Boolean  @default(true) @map("is_active")
  
  // Relaciones
  users           User[]
  residents       Resident[]
  
  // Timestamps
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")
  
  @@map("sedes")
}

// Tabla de Residentes
model Resident {
  id                String       @id @default(uuid())
  rut               String       @unique
  firstName         String       @map("first_name")
  lastName          String       @map("last_name")
  birthDate         DateTime     @map("birth_date")
  gender            Gender       @default(OTRO)
  nationality       String?      @default("Chilena")
  maritalStatus     MaritalStatus? @map("marital_status")
  phone             String?
  email             String?
  
  // Información de ingreso
  admissionDate     DateTime     @map("admission_date")
  admissionReason   String?      @map("admission_reason")
  origin            String?
  legalStatus       String?      @map("legal_status")
  
  // Información médica
  bloodType         String?      @map("blood_type")
  allergies         String?
  medications       String?
  healthNotes       String?      @map("health_notes")
  
  // Información educativa/laboral
  educationLevel    EducationLevel? @map("education_level")
  currentOccupation String?      @map("current_occupation")
  dailyActivity     String?      @map("daily_activity")
  
  // Estado
  status            ResidentStatus @default(ACTIVO)
  dischargeDate     DateTime?    @map("discharge_date")
  dischargeReason   String?      @map("discharge_reason")
  
  // Relaciones
  sedeId           String?      @map("sede_id")
  sede             Sede?        @relation(fields: [sedeId], references: [id])
  responsibleId    String?      @map("responsible_id")
  responsible      User?        @relation(fields: [responsibleId], references: [id])
  contacts         Contact[]
  psychologicalNotes PsychologicalNote[]
  socialNotes      SocialNote[]
  medicalReports   MedicalReport[]
  
  // Timestamps
  createdAt        DateTime     @default(now()) @map("created_at")
  updatedAt        DateTime     @updatedAt @map("updated_at")
  createdById      String?      @map("created_by")
  createdBy        User?        @relation("ResidentCreatedBy", fields: [createdById], references: [id])
  
  @@map("residents")
}

// Tabla de Contactos
model Contact {
  id                   String   @id @default(uuid())
  residentId           String   @map("resident_id")
  name                 String
  relationship         String?
  phone                String
  email                String?
  address              String?
  isEmergencyContact   Boolean  @default(false) @map("is_emergency_contact")
  notes                String?
  
  // Relaciones
  resident             Resident @relation(fields: [residentId], references: [id], onDelete: Cascade)
  
  // Timestamps
  createdAt            DateTime @default(now()) @map("created_at")
  
  @@map("contacts")
}

// Tabla de Notas Psicológicas
model PsychologicalNote {
  id                String   @id @default(uuid())
  residentId        String   @map("resident_id")
  psychologistId    String?  @map("psychologist_id")
  sessionDate       DateTime @map("session_date")
  sessionType       SessionType @map("session_type")
  content           String
  diagnosis         String?
  recommendations   String?
  nextSession       DateTime? @map("next_session")
  
  // Relaciones
  resident          Resident @relation(fields: [residentId], references: [id], onDelete: Cascade)
  psychologist      User?    @relation(fields: [psychologistId], references: [id])
  
  // Timestamps
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")
  
  @@map("psychological_notes")
}

// Tabla de Notas Sociales
model SocialNote {
  id                  String   @id @default(uuid())
  residentId          String   @map("resident_id")
  socialWorkerId      String?  @map("social_worker_id")
  date                DateTime
  interventionType    String?  @map("intervention_type")
  description         String
  actionsTaken        String?  @map("actions_taken")
  agreements          String?
  nextIntervention    DateTime? @map("next_intervention")
  
  // Relaciones
  resident            Resident @relation(fields: [residentId], references: [id], onDelete: Cascade)
  socialWorker        User?    @relation(fields: [socialWorkerId], references: [id])
  
  // Timestamps
  createdAt           DateTime @default(now()) @map("created_at")
  
  @@map("social_notes")
}

// Tabla de Informes Médicos
model MedicalReport {
  id                  String   @id @default(uuid())
  residentId          String   @map("resident_id")
  date                DateTime
  reason              String?
  diagnosis           String?
  treatment           String?
  prescribedMedications String? @map("prescribed_medications")
  nextAppointment     DateTime? @map("next_appointment")
  notes               String?
  
  // Relaciones
  resident            Resident @relation(fields: [residentId], references: [id], onDelete: Cascade)
  
  // Timestamps
  createdAt           DateTime @default(now()) @map("created_at")
  
  @@map("medical_reports")
}

// Enums
enum Role {
  DIRECTORA
  PSICOLOGA
  TRABAJADORA_SOCIAL
  ADMIN
  VOLUNTARIO
}

enum SedeType {
  CASA_ACOGIDA
  CENTRO_DIA
  RESIDENCIA
  OTRO
}

enum Gender {
  MASCULINO
  FEMENINO
  OTRO
  NO_ESPECIFICA
}

enum MaritalStatus {
  SOLTERO
  CASADO
  DIVORCIADO
  VIUDO
  SEPARADO
}

enum EducationLevel {
  NINGUNA
  BASICA
  MEDIA
  TECNICA
  UNIVERSITARIA
  POSTGRADO
}

enum ResidentStatus {
  ACTIVO
  INACTIVO
  EGRESADO
  TRANSFERIDO
}

enum SessionType {
  INDIVIDUAL
  GRUPAL
  EVALUACION
  SEGUIMIENTO
}